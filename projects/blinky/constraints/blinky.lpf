# ECP5-5G Versa Development Kit Constraints
# Board: LFE5UM5G-45F-VERSA-EVN
# Device: LFE5UM5G-45F-8BG381C
# Project: Intel 8008 Vintage CPU Implementation

# ====================================================================================
# Clock Inputs
# ====================================================================================

# 100 MHz LVDS Oscillator (X1) - General Purpose Clock
# Bank 6 - Connects to PCLKT6_0/PCLKC6_0
# Note: P3 is the positive pin of the LVDS pair
LOCATE COMP "clk" SITE "P3";
IOBUF PORT "clk" IO_TYPE=LVDS DIFFRESISTOR=100;
FREQUENCY PORT "clk" 100 MHz;

# Internal generated clocks (phi1 and phi2 from phase_clocks module)
# These are generated clocks derived from the 100 MHz system clock
# phi1/phi2 run at approximately 455 kHz (100MHz / 220)
# CRITICAL: Mark these as clocks so synthesis routes them properly
FREQUENCY NET "phi1" 455 kHz;
FREQUENCY NET "phi2" 455 kHz;

# ====================================================================================
# Reset (using a button or switch)
# ====================================================================================

# Using SW3-1 as reset
# SW3 switches are active-low: logic 0 when ON (arrow up), logic 1 when OFF (down)
# rst='0' (ON/up) = normal operation, rst='1' (OFF/down) = reset active
# Bank 7 - 1.5V
LOCATE COMP "rst" SITE "H2";
IOBUF PORT "rst" IO_TYPE=LVCMOS15;

# ====================================================================================
# Intel 8008 CPU Debug Outputs - 16 signals from internal CPU
# ====================================================================================
# These expose the 15 non-power pins of the Intel 8008 CPU plus one extra

# 8008 Data Bus (D0-D7) - 8 pins
# Using 12mA drive strength for better signal integrity on logic analyzer
LOCATE COMP "cpu_d[0]" SITE "A12";
IOBUF PORT "cpu_d[0]" IO_TYPE=LVCMOS33 DRIVE=12;

LOCATE COMP "cpu_d[1]" SITE "A13";
IOBUF PORT "cpu_d[1]" IO_TYPE=LVCMOS33 DRIVE=12;

LOCATE COMP "cpu_d[2]" SITE "B13";
IOBUF PORT "cpu_d[2]" IO_TYPE=LVCMOS33 DRIVE=12;

LOCATE COMP "cpu_d[3]" SITE "C13";
IOBUF PORT "cpu_d[3]" IO_TYPE=LVCMOS33 DRIVE=12;

LOCATE COMP "cpu_d[4]" SITE "D13";
IOBUF PORT "cpu_d[4]" IO_TYPE=LVCMOS33 DRIVE=12;

LOCATE COMP "cpu_d[5]" SITE "E13";
IOBUF PORT "cpu_d[5]" IO_TYPE=LVCMOS33 DRIVE=12;

LOCATE COMP "cpu_d[6]" SITE "A14";
IOBUF PORT "cpu_d[6]" IO_TYPE=LVCMOS33 DRIVE=12;

LOCATE COMP "cpu_d[7]" SITE "C14";
IOBUF PORT "cpu_d[7]" IO_TYPE=LVCMOS33 DRIVE=12;

# 8008 State Outputs (S0, S1, S2) - 3 pins
LOCATE COMP "cpu_s0" SITE "D14";
IOBUF PORT "cpu_s0" IO_TYPE=LVCMOS33;

LOCATE COMP "cpu_s1" SITE "E14";
IOBUF PORT "cpu_s1" IO_TYPE=LVCMOS33;

LOCATE COMP "cpu_s2" SITE "D11";
IOBUF PORT "cpu_s2" IO_TYPE=LVCMOS33;

# 8008 SYNC Output
LOCATE COMP "cpu_sync" SITE "C10";
IOBUF PORT "cpu_sync" IO_TYPE=LVCMOS33;

# Phase Clocks (φ1 and φ2) - 2 pins
LOCATE COMP "cpu_phi1" SITE "A9";
IOBUF PORT "cpu_phi1" IO_TYPE=LVCMOS33;

LOCATE COMP "cpu_phi2" SITE "B10";
IOBUF PORT "cpu_phi2" IO_TYPE=LVCMOS33;

# READY signal
LOCATE COMP "cpu_ready" SITE "D12";
IOBUF PORT "cpu_ready" IO_TYPE=LVCMOS33;

# INTERRUPT signal
LOCATE COMP "cpu_int" SITE "E12";
IOBUF PORT "cpu_int" IO_TYPE=LVCMOS33;

# ====================================================================================
# Memory Interface - Managed by memory_controller module
# ====================================================================================
# These connect to external RAM/ROM chips (or FPGA block RAM)

# Memory Address Bus (14-bit) - Latched from 8008 data bus during T1/T2
# LOCATE COMP "mem_addr[0]" SITE "TBD";
# IOBUF PORT "mem_addr[0]" IO_TYPE=LVCMOS33;
# ... (continue for mem_addr[1] through mem_addr[13])

# Memory Data Bus (8-bit) - Separate from 8008 data bus
# LOCATE COMP "mem_data[0]" SITE "TBD";
# IOBUF PORT "mem_data[0]" IO_TYPE=LVCMOS33;
# ... (continue for mem_data[1] through mem_data[7])

# Memory Control Signals
# LOCATE COMP "mem_read_n" SITE "TBD";   # Memory read enable (active low)
# IOBUF PORT "mem_read_n" IO_TYPE=LVCMOS33;
# LOCATE COMP "mem_write_n" SITE "TBD";  # Memory write enable (active low)
# IOBUF PORT "mem_write_n" IO_TYPE=LVCMOS33;
# LOCATE COMP "rom_cs_n" SITE "TBD";     # ROM chip select (active low)
# IOBUF PORT "rom_cs_n" IO_TYPE=LVCMOS33;
# LOCATE COMP "ram_cs_n" SITE "TBD";     # RAM chip select (active low)
# IOBUF PORT "ram_cs_n" IO_TYPE=LVCMOS33;

# ====================================================================================
# I/O Interface - Managed by io_controller module
# ====================================================================================
# I/O port connections

# I/O Address (5-bit for 8008 - allows 32 ports)
# LOCATE COMP "io_addr[0]" SITE "TBD";
# IOBUF PORT "io_addr[0]" IO_TYPE=LVCMOS33;
# ... (continue for io_addr[1] through io_addr[4])

# I/O Data Bus
# LOCATE COMP "io_data[0]" SITE "TBD";
# IOBUF PORT "io_data[0]" IO_TYPE=LVCMOS33;
# ... (continue for io_data[1] through io_data[7])

# I/O Control Signals
# LOCATE COMP "io_read_n" SITE "TBD";    # I/O read enable (active low)
# IOBUF PORT "io_read_n" IO_TYPE=LVCMOS33;
# LOCATE COMP "io_write_n" SITE "TBD";   # I/O write enable (active low)
# IOBUF PORT "io_write_n" IO_TYPE=LVCMOS33;

# ====================================================================================
# Push Buttons - User Input
# ====================================================================================

# Button on B19 (Bank 1 - 3.3V) - Active Low (pulled to GND when pressed)
LOCATE COMP "speed_btn" SITE "B19";
IOBUF PORT "speed_btn" IO_TYPE=LVCMOS33 PULLMODE=UP;

# ====================================================================================
# LED Outputs
# ====================================================================================

# Main Program LED (active low)
LOCATE COMP "debug_led" SITE "E16";
IOBUF PORT "debug_led" IO_TYPE=LVCMOS25;

# Phase clock indicator LEDs (active low) - KEEP
LOCATE COMP "led_phi1" SITE "D17";
IOBUF PORT "led_phi1" IO_TYPE=LVCMOS25;

LOCATE COMP "led_phi2" SITE "D18";
IOBUF PORT "led_phi2" IO_TYPE=LVCMOS25;

# Diagnostic Test LEDs (active low)
LOCATE COMP "led_test1" SITE "E18";
IOBUF PORT "led_test1" IO_TYPE=LVCMOS25;

LOCATE COMP "led_test2" SITE "F17";
IOBUF PORT "led_test2" IO_TYPE=LVCMOS25;

LOCATE COMP "led_test3" SITE "F18";
IOBUF PORT "led_test3" IO_TYPE=LVCMOS25;

LOCATE COMP "led_test4" SITE "E17";
IOBUF PORT "led_test4" IO_TYPE=LVCMOS25;

LOCATE COMP "led_test5" SITE "F16";
IOBUF PORT "led_test5" IO_TYPE=LVCMOS25;

# Raw phi1 diagnostic LED (active low)
LOCATE COMP "led_phi1_raw" SITE "M20";
IOBUF PORT "led_phi1_raw" IO_TYPE=LVCMOS25;

# Reference LED (always on for brightness comparison)
LOCATE COMP "led_ref_on" SITE "L18";
IOBUF PORT "led_ref_on" IO_TYPE=LVCMOS25;

# ====================================================================================
# Configuration
# ====================================================================================

# These apply to the entire design
SYSCONFIG CONFIG_IOVOLTAGE=3.3 COMPRESS_CONFIG=ON MCCLK_FREQ=62;

# ====================================================================================
# Notes
# ====================================================================================
#
# This constraints file provides basic mappings for the Intel 8008 implementation.
# As you develop modules, uncomment and assign the appropriate pins for:
#   - Data bus (8-bit bidirectional)
#   - Address bus (14-bit output)
#   - Control signals (S0, S1, S2, SYNC, READY, INTERRUPT)
#
# The debug LEDs and switches are fully mapped and ready to use for testing.
#
# Refer to the ECP5-5G Versa Development Kit User Guide for complete pin listings:
# https://www.latticesemi.com/products/developmentboardsandkits/ecp55gversadevkit
#
